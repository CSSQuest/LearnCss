<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorials — LearnCSS</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <header class="site-header">
        <div class="container header-inner">
            <a class="brand" href="index.html">
                <span class="brand-mark" aria-hidden="true">*</span>
                <span class="brand-text">LearnCSS</span>
            </a>
            <nav class="site-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="tutorials.html" class="active">Tutorials</a></li>
                    <li><a href="editor.html">Editor</a></li>
                    <li><a href="about.html">About</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="docs-layout">

        <aside class="docs-sidebar">
            <nav class="docs-nav" id="sidebar-nav">
                </nav>
        </aside>

        <main class="docs-content" id="content-area">
            <p>Loading lesson...</p>
        </main>
    </div>

    <script src="lessons.js"></script>

    <script>
        // ---------------------------------------------------------
        // 1. SIDEBAR OLUŞTURMA
        // ---------------------------------------------------------
        function generateSidebar() {
            const navContainer = document.getElementById('sidebar-nav');
            if (typeof lessonsData === 'undefined' || !navContainer) return;
            navContainer.innerHTML = ''; 

            const categories = new Set();
            const groupedLessons = {};
            let globalCounter = 1;

            Object.keys(lessonsData).forEach(key => {
                const lesson = lessonsData[key];
                const category = lesson.category || 'General';

                if (!categories.has(category)) {
                    categories.add(category);
                    groupedLessons[category] = [];
                }
                groupedLessons[category].push({
                    id: key, title: lesson.title, number: globalCounter++
                });
            });

            categories.forEach(category => {
                const h3 = document.createElement('h3');
                h3.textContent = category;
                navContainer.appendChild(h3);
                const ul = document.createElement('ul');
                groupedLessons[category].forEach(item => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = `?id=${item.id}`;
                    a.id = `link-${item.id}`;
                    a.textContent = `${item.number}. ${item.title}`;
                    li.appendChild(a);
                    ul.appendChild(li);
                });
                navContainer.appendChild(ul);
            });
        }

        // ---------------------------------------------------------
        // 2. DERSİ YÜKLEME
        // ---------------------------------------------------------
        function loadLesson(id) {
            const contentArea = document.getElementById('content-area');
            const lesson = lessonsData[id];
            
            if (!lesson) {
                contentArea.innerHTML = `<h1>404</h1><p>Lesson not found.</p>`;
                return;
            }

            // Navigasyon Mantığı
            const keys = Object.keys(lessonsData);
            const idx = keys.indexOf(id);
            const prevKey = keys[idx - 1];
            const nextKey = keys[idx + 1];
            const prev = prevKey ? lessonsData[prevKey] : null;
            const next = nextKey ? lessonsData[nextKey] : null;

            const navHTML = `
                <div class="lesson-nav">
                    ${prev ? `<a href="?id=${prevKey}" class="btn btn-outline">← ${prev.title}</a>` : '<div></div>'}
                    ${next ? `<a href="?id=${nextKey}" class="btn btn-primary">${next.title} →</a>` : '<div></div>'}
                </div>`;

            contentArea.innerHTML = `
                <span class="lesson-tag">${lesson.category}</span>
                <h1>${lesson.title}</h1>
                ${lesson.content}
                ${navHTML}
            `;

            // Sayfa işlemlerini yap
            enhanceExamples();
            handleManualButtons();
            highlightActiveLink(id);

            window.scrollTo(0, 0);
        }

        // ---------------------------------------------------------
        // 3. YARDIMCI FONKSİYONLAR
        // ---------------------------------------------------------
        
        function highlightActiveLink(id) {
            document.querySelectorAll('.docs-nav a').forEach(a => a.classList.remove('active'));
            const active = document.getElementById(`link-${id}`);
            if (active) {
                active.classList.add('active');
                active.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Kod bloklarına otomatik kart ve buton ekler
        function enhanceExamples() {
            document.querySelectorAll('.code-block').forEach(block => {
                if (block.closest('.example-card')) return;

                const wrapper = document.createElement('div');
                wrapper.className = 'example-card';
                
                const title = document.createElement('h3');
                title.textContent = 'Example';

                const btn = document.createElement('a');
                btn.href = 'editor.html';
                btn.className = 'try-btn open-editor';
                btn.textContent = 'Open Live Editor »';
                btn.target = '_blank';

                // Veriyi güvene al (wrapper'a taşı)
                wrapper.dataset.html = block.dataset.html || "";
                // Eğer data-css yoksa ve içerik CSS ise textContent'i kullan (Intro dersi için)
                wrapper.dataset.css = block.dataset.css || block.textContent || "";

                block.parentNode.insertBefore(wrapper, block);
                wrapper.appendChild(title);
                wrapper.appendChild(block);
                wrapper.appendChild(btn);
            });
        }

        // Manuel eklenmiş butonları da yakala
        function handleManualButtons() {
            document.querySelectorAll('a[href="editor.html"]').forEach(btn => {
                btn.target = "_blank";
                btn.classList.add('open-editor');
            });
        }

        // ---------------------------------------------------------
        // 4. VERİ GÖNDERME (DÜZELTİLMİŞ MANTIK)
        // ---------------------------------------------------------
        document.addEventListener("click", function (e) {
            const btn = e.target.closest(".open-editor");
            if (!btn) return;

            e.preventDefault();

            const targetId = btn.dataset.target;
            let block = null;

            if (targetId) {
                block = document.getElementById(targetId);
            } else {
                block = btn.closest(".example-card")?.querySelector(".code-block");
            }

            if (!block) return;

            const htmlVal = block.dataset.html || "";
            const cssVal = block.dataset.css || "";

            localStorage.setItem("editorHTML", htmlVal);
            localStorage.setItem("editorCSS", cssVal);

            window.open("editor.html", "_blank");
        });


        // BAŞLAT
        document.addEventListener('DOMContentLoaded', () => {
            generateSidebar();
            const params = new URLSearchParams(window.location.search);
            loadLesson(params.get('id') || 'intro');
        });
    </script>

    <footer class="site-footer">
        <div class="container footer-inner">
            <p>© <span id="year"></span> NextHive — LearnCSS</p>
            <nav aria-label="Footer">
                <a href="#">Privacy</a>
                <a href="#">Terms</a>
                <a href="about.html">Contact</a>
            </nav>
        </div>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
    </script>
</body>
</html>